rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    
    // Helper functions
    function isAdmin() {
      return request.auth != null && 
             request.auth.token.email != null &&
             (request.auth.token.admin == true || 
              request.auth.token.email in ['your-admin-email@example.com']);
    }
    
    // Menu images folder
    // - Anyone can read (public access for product images)
    // - Only admins can upload/modify images
    match /menu/{imageId} {
      allow read: if true;
      allow write: if isAdmin() && 
                      request.resource.size < 5 * 1024 * 1024 &&  // Max 5MB
                      request.resource.contentType.matches('image/.*');
    }
    
    // Default rule for all other files
    match /{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if isAdmin();
    }
  }
}

// SETUP INSTRUCTIONS:
//
// 1. Enable Firebase Storage:
//    - Go to Firebase Console: https://console.firebase.google.com/
//    - Select your project (kinder-87e7e)
//    - Click "Storage" in the left sidebar
//    - Click "Get Started"
//    - Use default settings or choose production mode
//    - Select same location as Firestore
//
// 2. Deploy these storage rules:
//    - In Firebase Console, go to Storage > Rules tab
//    - Copy and paste the rules above
//    - Replace 'your-admin-email@example.com' with your actual admin email
//    - Click "Publish"
//
// TEMPORARY DEVELOPMENT RULES (⚠️ INSECURE - DO NOT USE IN PRODUCTION):
// Use these ONLY for initial testing:
//
// rules_version = '2';
// service firebase.storage {
//   match /b/{bucket}/o {
//     match /{allPaths=**} {
//       allow read, write: if true;  // WARNING: Anyone can read/write!
//     }
//   }
// }
